<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DOM Range API 详解</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
      }

      @media (max-width: 900px) {
        .container {
          grid-template-columns: 1fr;
        }
      }

      header {
        grid-column: 1 / -1;
        text-align: center;
        padding: 30px 0;
        margin-bottom: 20px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 15px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      h1 {
        font-size: 2.8rem;
        color: #2c3e50;
        margin-bottom: 15px;
      }

      .subtitle {
        font-size: 1.4rem;
        color: #7f8c8d;
        max-width: 800px;
        margin: 0 auto;
      }

      .panel {
        background: white;
        border-radius: 15px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        padding: 30px;
        transition: transform 0.3s ease;
      }

      .panel:hover {
        transform: translateY(-5px);
      }

      .panel h2 {
        color: #3498db;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f1f1f1;
      }

      .doc-structure {
        background: #fff;
        border-radius: 10px;
        padding: 25px;
        margin: 20px 0;
        border: 2px solid #e0e0e0;
        position: relative;
      }

      .doc-structure::before {
        content: "DOM结构";
        position: absolute;
        top: -12px;
        left: 20px;
        background: white;
        padding: 0 10px;
        font-weight: bold;
        color: #7f8c8d;
      }

      .node {
        margin: 10px 0;
        padding: 8px 15px;
        border-radius: 8px;
        background: #f8f9fa;
        font-family: "Courier New", monospace;
        position: relative;
      }

      .element-node {
        border-left: 4px solid #3498db;
        background: #e3f2fd;
      }

      .text-node {
        border-left: 4px solid #2ecc71;
        background: #e8f5e9;
        margin-left: 20px;
      }

      .highlight {
        background: #fff9c4;
        box-shadow: 0 0 0 3px #ffeb3b;
      }

      .range-info {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        margin: 25px 0;
      }

      .property {
        display: flex;
        margin: 15px 0;
        padding: 12px;
        border-radius: 8px;
        background: white;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      }

      .property-name {
        flex: 0 0 200px;
        font-weight: bold;
        color: #2c3e50;
      }

      .property-value {
        flex: 1;
        font-family: "Courier New", monospace;
        color: #e74c3c;
        word-break: break-all;
      }

      .controls {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin: 25px 0;
      }

      .btn {
        padding: 12px 20px;
        border: none;
        border-radius: 8px;
        background: #3498db;
        color: white;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        flex: 1;
        min-width: 150px;
      }

      .btn:hover {
        background: #2980b9;
        transform: translateY(-2px);
      }

      .btn:active {
        transform: translateY(1px);
      }

      .explanation {
        background: #e3f2fd;
        padding: 20px;
        border-radius: 10px;
        margin-top: 25px;
        border-left: 4px solid #3498db;
      }

      .visual-range {
        background: rgba(155, 89, 182, 0.1);
        border-radius: 4px;
        padding: 5px 0;
        margin: 10px 0;
      }

      .common-ancestor {
        background: rgba(241, 196, 15, 0.2);
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
        border: 2px dashed #f1c40f;
      }

      .legend {
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        margin-top: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .color-box {
        width: 20px;
        height: 20px;
        border-radius: 4px;
      }

      .range-color {
        background: rgba(155, 89, 182, 0.3);
      }

      .ancestor-color {
        background: rgba(241, 196, 15, 0.3);
      }

      .start-color {
        background: rgba(46, 204, 113, 0.3);
      }

      .end-color {
        background: rgba(231, 76, 60, 0.3);
      }

      .example-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .example {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      }

      .example-title {
        color: #9b59b6;
        margin-bottom: 15px;
      }

      footer {
        grid-column: 1 / -1;
        text-align: center;
        padding: 30px 0;
        color: #7f8c8d;
        margin-top: 30px;
        border-top: 1px solid #eee;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>DOM Range API 详解</h1>
        <p class="subtitle">
          深入理解 startContainer、startOffset、endContainer、endOffset 和
          commonAncestorContainer
        </p>
      </header>

      <div class="panel">
        <h2>DOM 结构可视化</h2>

        <div class="doc-structure">
          <div class="node element-node" id="divNode">
            div#container (元素节点)
          </div>

          <div class="node element-node" id="p1Node">
            p#paragraph1 (元素节点)
          </div>
          <div class="node text-node" id="text1Node">
            "这是第一个段落，包含" (文本节点)
          </div>
          <div class="node element-node" id="bNode">b (元素节点)</div>
          <div class="node text-node" id="boldTextNode">
            "加粗文本" (文本节点)
          </div>
          <div class="node text-node" id="text2Node">
            "和普通文本。" (文本节点)
          </div>

          <div class="node element-node" id="p2Node">
            p#paragraph2 (元素节点)
          </div>
          <div class="node text-node" id="text3Node">
            "这是第二个段落，用于演示跨段落选区。" (文本节点)
          </div>

          <div class="node element-node" id="p3Node">
            p#paragraph3 (元素节点)
          </div>
          <div class="node text-node" id="text4Node">
            "第三个段落，包含" (文本节点)
          </div>
          <div class="node element-node" id="iNode">i (元素节点)</div>
          <div class="node text-node" id="italicTextNode">
            "斜体文本" (文本节点)
          </div>
          <div class="node text-node" id="text5Node">
            "和其他内容。" (文本节点)
          </div>
        </div>

        <div class="range-info">
          <h3>当前选区信息</h3>

          <div class="property">
            <div class="property-name">startContainer:</div>
            <div class="property-value" id="startContainerVal">未选择</div>
          </div>

          <div class="property">
            <div class="property-name">startOffset:</div>
            <div class="property-value" id="startOffsetVal">-</div>
          </div>

          <div class="property">
            <div class="property-name">endContainer:</div>
            <div class="property-value" id="endContainerVal">未选择</div>
          </div>

          <div class="property">
            <div class="property-name">endOffset:</div>
            <div class="property-value" id="endOffsetVal">-</div>
          </div>

          <div class="property">
            <div class="property-name">commonAncestorContainer:</div>
            <div class="property-value" id="commonAncestorVal">-</div>
          </div>
        </div>

        <div class="controls">
          <button class="btn" id="example1Btn">
            示例1: 单个文本节点内选区
          </button>
          <button class="btn" id="example2Btn">
            示例2: 从文本节点到元素节点
          </button>
          <button class="btn" id="example3Btn">示例3: 跨段落选区</button>
          <button class="btn" id="example4Btn">示例4: 从元素到文本节点</button>
          <button class="btn" id="resetBtn">重置选区</button>
        </div>

        <div class="explanation">
          <h3>概念解释</h3>
          <p>
            <strong>startContainer</strong>:
            选区起点所在的节点（文本节点或元素节点）。
          </p>
          <p>
            <strong>startOffset</strong>: - 对于文本节点：选区起点之前的字符数 -
            对于元素节点：选区中第一个子节点的索引
          </p>
          <p><strong>endContainer</strong>: 选区终点所在的节点。</p>
          <p>
            <strong>endOffset</strong>: 与 startOffset
            规则相同，应用于终点节点。
          </p>
          <p>
            <strong>commonAncestorContainer</strong>:
            包含起点和终点节点的最深公共祖先节点。
          </p>
        </div>
      </div>

      <div class="panel">
        <h2>示例说明</h2>

        <div class="example-container">
          <div class="example">
            <h3 class="example-title">示例1: 单个文本节点内选区</h3>
            <p>选择第一个段落中的文本节点："这是第一个段落，包含"</p>
            <div class="visual-range" style="padding: 10px">
              <div class="node text-node highlight">
                这是<span style="background: rgba(155, 89, 182, 0.3)"
                  >第一个</span
                >段落，包含
              </div>
            </div>
            <p>
              <strong>startContainer</strong>: 文本节点 "这是第一个段落，包含"
            </p>
            <p><strong>startOffset</strong>: 2 (起点在"第"字前)</p>
            <p>
              <strong>endContainer</strong>: 文本节点 "这是第一个段落，包含"
            </p>
            <p><strong>endOffset</strong>: 5 (终点在"个"字后)</p>
            <p>
              <strong>commonAncestorContainer</strong>:
              文本节点自身（因为起点和终点在同一个节点）
            </p>
          </div>

          <div class="example">
            <h3 class="example-title">示例2: 从文本节点到元素节点</h3>
            <p>从第一个段落的文本节点到加粗元素</p>
            <div class="visual-range" style="padding: 10px">
              <div class="node text-node">
                这是第一个段落，包含
                <span style="background: rgba(155, 89, 182, 0.3)">
                  <b>加粗文本</b>
                </span>
              </div>
            </div>
            <p>
              <strong>startContainer</strong>: 文本节点 "这是第一个段落，包含"
            </p>
            <p><strong>startOffset</strong>: 8 (起点在文本节点末尾)</p>
            <p><strong>endContainer</strong>: p#paragraph1 元素节点</p>
            <p>
              <strong>endOffset</strong>: 2
              (终点在p元素的第二个子节点后，即b元素后)
            </p>
            <p>
              <strong>commonAncestorContainer</strong>: p#paragraph1 元素节点
            </p>
          </div>

          <div class="example">
            <h3 class="example-title">示例3: 跨段落选区</h3>
            <p>从第一个段落到第二个段落</p>
            <div class="visual-range" style="padding: 10px">
              <div class="node text-node">
                这是第一个段落，包含
                <b>加粗文本</b>
                和普通文本。
              </div>
              <div
                class="node text-node"
                style="background: rgba(155, 89, 182, 0.3)"
              >
                这是第二个段落，用于演示跨段落选区。
              </div>
            </div>
            <p><strong>startContainer</strong>: p#paragraph1 元素节点</p>
            <p><strong>startOffset</strong>: 1 (起点在p元素的第一个子节点后)</p>
            <p>
              <strong>endContainer</strong>: 文本节点
              "这是第二个段落，用于演示跨段落选区。"
            </p>
            <p><strong>endOffset</strong>: 10 (终点在文本节点的第10个字符后)</p>
            <p>
              <strong>commonAncestorContainer</strong>: div#container 元素节点
            </p>
          </div>

          <div class="common-ancestor">
            <h3>共同祖先容器 (commonAncestorContainer)</h3>
            <p>
              这是包含起点和终点节点的最深节点，无论起点和终点在DOM树中相距多远。
            </p>
            <p>
              例如，在跨段落选区中，起点在第一个段落，终点在第二个段落，它们的共同祖先就是包含这两个段落的div容器。
            </p>
          </div>

          <div class="legend">
            <div class="legend-item">
              <div class="color-box range-color"></div>
              <span>选区范围</span>
            </div>
            <div class="legend-item">
              <div class="color-box ancestor-color"></div>
              <span>共同祖先容器</span>
            </div>
            <div class="legend-item">
              <div class="color-box start-color"></div>
              <span>起点节点</span>
            </div>
            <div class="legend-item">
              <div class="color-box end-color"></div>
              <span>终点节点</span>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <p>DOM Range API 详解 &copy; 2023 | 通过可视化示例深入理解DOM选区</p>
      </footer>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const startContainerVal = document.getElementById("startContainerVal");
        const startOffsetVal = document.getElementById("startOffsetVal");
        const endContainerVal = document.getElementById("endContainerVal");
        const endOffsetVal = document.getElementById("endOffsetVal");
        const commonAncestorVal = document.getElementById("commonAncestorVal");

        const example1Btn = document.getElementById("example1Btn");
        const example2Btn = document.getElementById("example2Btn");
        const example3Btn = document.getElementById("example3Btn");
        const example4Btn = document.getElementById("example4Btn");
        const resetBtn = document.getElementById("resetBtn");

        // 模拟DOM节点
        const domNodes = {
          div: { type: "元素节点", name: "div#container" },
          p1: { type: "元素节点", name: "p#paragraph1" },
          text1: { type: "文本节点", name: '"这是第一个段落，包含"' },
          b: { type: "元素节点", name: "b" },
          boldText: { type: "文本节点", name: '"加粗文本"' },
          text2: { type: "文本节点", name: '"和普通文本。"' },
          p2: { type: "元素节点", name: "p#paragraph2" },
          text3: {
            type: "文本节点",
            name: '"这是第二个段落，用于演示跨段落选区。"',
          },
          p3: { type: "元素节点", name: "p#paragraph3" },
          text4: { type: "文本节点", name: '"第三个段落，包含"' },
          i: { type: "元素节点", name: "i" },
          italicText: { type: "文本节点", name: '"斜体文本"' },
          text5: { type: "文本节点", name: '"和其他内容。"' },
        };

        // 示例1：单个文本节点内选区
        example1Btn.addEventListener("click", function () {
          startContainerVal.textContent = domNodes.text1.name;
          startOffsetVal.textContent = "2";
          endContainerVal.textContent = domNodes.text1.name;
          endOffsetVal.textContent = "5";
          commonAncestorVal.textContent = domNodes.text1.name;

          highlightExample(1);
        });

        // 示例2：从文本节点到元素节点
        example2Btn.addEventListener("click", function () {
          startContainerVal.textContent = domNodes.text1.name;
          startOffsetVal.textContent = "8";
          endContainerVal.textContent = domNodes.p1.name;
          endOffsetVal.textContent = "2";
          commonAncestorVal.textContent = domNodes.p1.name;

          highlightExample(2);
        });

        // 示例3：跨段落选区
        example3Btn.addEventListener("click", function () {
          startContainerVal.textContent = domNodes.p1.name;
          startOffsetVal.textContent = "1";
          endContainerVal.textContent = domNodes.text3.name;
          endOffsetVal.textContent = "10";
          commonAncestorVal.textContent = domNodes.div.name;

          highlightExample(3);
        });

        // 示例4：从元素到文本节点
        example4Btn.addEventListener("click", function () {
          startContainerVal.textContent = domNodes.b.name;
          startOffsetVal.textContent = "0";
          endContainerVal.textContent = domNodes.text2.name;
          endOffsetVal.textContent = "4";
          commonAncestorVal.textContent = domNodes.p1.name;

          highlightExample(4);
        });

        // 重置选区
        resetBtn.addEventListener("click", function () {
          startContainerVal.textContent = "未选择";
          startOffsetVal.textContent = "-";
          endContainerVal.textContent = "未选择";
          endOffsetVal.textContent = "-";
          commonAncestorVal.textContent = "-";

          // 移除所有高亮
          document.querySelectorAll(".highlight").forEach((el) => {
            el.classList.remove("highlight");
          });
        });

        // 高亮显示当前示例的选区
        function highlightExample(exampleNum) {
          // 先移除所有高亮
          document.querySelectorAll(".highlight").forEach((el) => {
            el.classList.remove("highlight");
          });

          // 根据示例添加高亮
          switch (exampleNum) {
            case 1:
              document.getElementById("text1Node").classList.add("highlight");
              break;
            case 2:
              document.getElementById("text1Node").classList.add("highlight");
              document.getElementById("bNode").classList.add("highlight");
              document
                .getElementById("boldTextNode")
                .classList.add("highlight");
              break;
            case 3:
              document.getElementById("text1Node").classList.add("highlight");
              document.getElementById("bNode").classList.add("highlight");
              document
                .getElementById("boldTextNode")
                .classList.add("highlight");
              document.getElementById("text2Node").classList.add("highlight");
              document.getElementById("p2Node").classList.add("highlight");
              document.getElementById("text3Node").classList.add("highlight");
              break;
            case 4:
              document.getElementById("bNode").classList.add("highlight");
              document
                .getElementById("boldTextNode")
                .classList.add("highlight");
              document.getElementById("text2Node").classList.add("highlight");
              break;
          }
        }
      });
    </script>
  </body>
</html>
